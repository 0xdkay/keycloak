=== Creating the Hello World AuthZ Realm

For this guide, we are going to create a *hello-world-authz* realm. Just import the following JSON file to create the new realm:

```json
{
  "realm" : "hello-world-authz",
  "enabled" : true,
  "privateKey" : "MIIEpQIBAAKCAQEAzMhNM9HXNQWhVf1m64zS67SIyQjj+tV5GR+MqlRTWDXdo8GAWHd+alY1urRhfRoqMy4F499+8wh2REKFykNt0ng6s6wWnEaKDboS3SAUV6lybcOAkwIOCtCZj1ItddKG3m64fzxDDQrcpkbiAvw3S8KJ4UJK+pyh9iX01duSDtM/HhPawsPdY8JSMfuo1IxQ2Vxw+8RKwbbdUeew6cyYGYAeFYwA66mlM3otB0RBHh4bjwg8297+2g53TdwM2rbCHRbrorMQD3031OTyFSp7lXCtoMLWRfAFnOP/2yZWZMXbiJheC0R3sLbU7Ef0/cUbYyk4Ckfq6pcYDR+VZBF7AwIDAQABAoIBAAwa4wVnKBOIS6srmYPfBTDNsTBBCEjxiYEErmn7JhoWxQ1DCPUxyxU6F177/q9Idqoj1FFOCtEO9P6/9+ym470HQmEQkR2Xxd1d3HOZy9oKuCro3ZbTDkVxY0JnlyxZz4MihGFxDH2e4MArfHy0sAgYbdIU+x2pWKGWSMzDd/TMSOExhc/sIQAg6ljbPCLLXCPQFAncoHRyGPrkRZs6UTZi5SJuCglVa2/3G+0drDdPuA83/mwsZfIBqQgbGbFgtq5T5C6CKMkPOQ42Rcclm7kEr6riTkJRo23EO1iOJVpxzI0tbxZsJAsW7zeqv0wWRyUgVfQAje6OdsNexp5aCtECgYEA6nMHCQ9xXvufCyzpIbYGxdAGqH6m1AR5gXerHqRiGNx+8UUt/E9cy/HTOhmZDK/eC4BT9tImeF01l1oSU/+wGKfux0SeAQchBhhq8GD6jmrtgczKAfZHp0Zrht7o9qu9KE7ZNWRmY1foJN9yNYmzY6qqHEy+zNo9amcqT7UZKO8CgYEA35sp9fMpMqkJE+NEJ9Ph/t2081BEkC0DYIuETZRSi+Ek5AliWTyEkg+oisTbWzi6fMQHS7W+M1SQP6djksLQNPP+353DKgup5gtKS+K/y2xNd7fSsNmkjW1bdJJpID7WzwwmwdahHxpcnFFuEXi5FkG3Vqmtd3cD0TYL33JlRy0CgYEA0+a3eybsDy9Zpp4m8IM3R98nxW8DlimdMLlafs2QpGvWiHdAgwWwF90wTxkHzgG+raKFQVbb0npcj7mnSyiUnxRZqt2H+eHZpUq4jR76F3LpzCGui2tvg+8QDMy4vwqmYyIxDCL8r9mqRnl3HpChBPoh2oY7BahTTjKEeZpzbR0CgYEAoNnVjX+mGzNNvGi4Fo5s/BIwoPcU20IGM+Uo/0W7O7Rx/Thi7x6BnzB0ZZ7GzRA51paNSQEsGXCzc5bOIjzR2cXLisDKK+zIAxwMDhrHLWZzM7OgdGeb38DTEUBhLzkE/VwYZUgoD1+/TxOkwhy9yCzt3gGhL1cF//GJCOwZvuECgYEAgsO4rdYScgCpsyePnHsFk+YtqtdORnmttF3JFcL3w2QneXuRwg2uW2Kfz8CVphrR9eOU0tiw38w6QTHIVeyRY8qqlHtiXj6dEYz7frh/k4hI29HwFx43rRpnAnN8kBEJYBYdbjaQ35Wsqkfu1tvHJ+6fxSwvQu/TVdGp0OfilAY=",
  "publicKey" : "MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAzMhNM9HXNQWhVf1m64zS67SIyQjj+tV5GR+MqlRTWDXdo8GAWHd+alY1urRhfRoqMy4F499+8wh2REKFykNt0ng6s6wWnEaKDboS3SAUV6lybcOAkwIOCtCZj1ItddKG3m64fzxDDQrcpkbiAvw3S8KJ4UJK+pyh9iX01duSDtM/HhPawsPdY8JSMfuo1IxQ2Vxw+8RKwbbdUeew6cyYGYAeFYwA66mlM3otB0RBHh4bjwg8297+2g53TdwM2rbCHRbrorMQD3031OTyFSp7lXCtoMLWRfAFnOP/2yZWZMXbiJheC0R3sLbU7Ef0/cUbYyk4Ckfq6pcYDR+VZBF7AwIDAQAB",
  "certificate" : "MIICsTCCAZkCBgFVETX4AzANBgkqhkiG9w0BAQsFADAcMRowGAYDVQQDDBFIZWxsbyBXb3JsZCBBdXRoWjAeFw0xNjA2MDIxMzAxMzdaFw0yNjA2MDIxMzAzMTdaMBwxGjAYBgNVBAMMEUhlbGxvIFdvcmxkIEF1dGhaMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAzMhNM9HXNQWhVf1m64zS67SIyQjj+tV5GR+MqlRTWDXdo8GAWHd+alY1urRhfRoqMy4F499+8wh2REKFykNt0ng6s6wWnEaKDboS3SAUV6lybcOAkwIOCtCZj1ItddKG3m64fzxDDQrcpkbiAvw3S8KJ4UJK+pyh9iX01duSDtM/HhPawsPdY8JSMfuo1IxQ2Vxw+8RKwbbdUeew6cyYGYAeFYwA66mlM3otB0RBHh4bjwg8297+2g53TdwM2rbCHRbrorMQD3031OTyFSp7lXCtoMLWRfAFnOP/2yZWZMXbiJheC0R3sLbU7Ef0/cUbYyk4Ckfq6pcYDR+VZBF7AwIDAQABMA0GCSqGSIb3DQEBCwUAA4IBAQANm5gIT/c50lwjawM686gNXpppLA928WsCOn9NIIWjSKekP8Bf9S73kf7vWcsEppm5B8rRyRxolXmzwghv74L7uVDg8Injjgj+XbPVQP+cJqWpSaMZHF7UfWe0/4M945Xcbmsl5q+m9PmrPG0AaaZhqXHcp4ehB1H+awyRqiERpJUuwZNycw2+2kjDADpsFf8hZVUd1F6ReYyOkqUyUjbL+jYTC7ZBNa7Ok+w6HCXWgkgVATAgQXJRM3w14IOc5MH/vfMCrCl/eNQLbjGl9y7u8PKwh3MXHDO2OLqtg6hOTSrOGUPJZGmGtUAl+2/R7FzoWkML/BNe2hjsL6UJwg91",
  "requiredCredentials" : [ "password" ],
  "roles" : {
    "realm" : [
      {
        "name" : "uma_protection"
      }
    ]
  },
  "users" :
    [
      {
        "username" : "alice",
        "enabled" : true,
        "credentials" : [ {
          "type" : "password",
          "value" : "password"
          } ],
        "clientRoles" : {
          "hello-world-authz-service" : [ "uma_authorization" ]
        }
      },
      {
        "username" : "jdoe",
        "enabled" : true,
        "credentials" : [ {
          "type" : "password",
          "value" : "password"
          } ],
        "clientRoles" : {
          "hello-world-authz-service" : [ "uma_authorization" ]
        }
      },
      {
        "username" : "service-account-hello-world-authz-service",
        "enabled" : true,
        "serviceAccountClientId" : "hello-world-authz-service",
        "realmRoles" : [ "uma_protection"]
      }
    ],
  "clients" : [
    {
      "clientId" : "hello-world-authz-service",
      "secret" : "password",
      "serviceAccountsEnabled" : true,
      "enabled" : true,
      "redirectUris" : [ "http://localhost:8080/hello-world-authz-service" ],
      "directAccessGrantsEnabled" : true,
      "publicClient" : false
    }
  ]
}
```
The realm *hello-world-authz* consists of:

** Two users: _alice_ and _jdoe_
** One client application: _hello-world-authz-service_
** One global role: _uma_protection_
** One client role: _uma_authorization_

The _hello-world-authz-service_ is the application with the resources we want to protect. In other words, it will act as a link:../overview/terminology.html[Resource Server].

In {{book.project.name}} a resource server is just a regular client application with some specific characteristics. It _must_ be a *confidential* client application as defined by:

```json
"publicClient" : false
```

It must have a  *client_id*, *client_secret* and *Service Account* enabled:

```json
"clients" : [
    {
      "clientId" : "hello-world-authz-service",
      "secret" : "7801be7c-437a-44ae-be34-67da32f024eb",
      "serviceAccountsEnabled" : true,
      ...
    }
]
```

And finally, an user mapping to the client's service account:

```json
{
    "username" : "service-account-my-resource-server",
    "enabled" : true,
    "serviceAccountClientId" : "hello-world-authz-service",
    "realmRoles" : [ "uma_protection"]
}
```

In the latter case, we are also granting the *uma_protection* role to the client's service account. As you'll see, that will be necessary in order to get access to the link:../service/protection-api.html[Protection API].

=== Creating a Resource Server and Protecting Resources

Now that we have the *hello-world-authz* realm properly configured, we need to enable the *hello-world-authz-service* as a resource server. For that, click on the *Authorization* in the left menu bar.

image:../../images/gs-keycloak-authz-page.png[alt="Keycloak Authorization Page"]

To create a resource server you can click on the *Create* button.

image:../../images/gs-keycloak-authz-create-rs-page.png[alt="Create Resource Server"]

From that page you can create a resource server by manually filling that form or you can just import a JSON file with the configuration you want. For this guide, we'll just import a JSON file as follows:

```json
{
  "clientId": "hello-world-authz-service",
  "resources": [
    {
      "name": "Hello World Resource"
    }
  ],
  "policies": [
    {
      "name": "Only Special Users Policy",
      "type": "user",
      "logic": "POSITIVE",
      "config": {
        "users": "[\"alice\"]"
      }
    },
    {
      "name": "Hello World Resource Permission",
      "type": "resource",
      "config": {
        "resources": "[\"Hello World Resource\"]",
        "applyPolicies": "[\"Only Special Users Policy\"]"
      }
    }
  ]
}

```

After importing the JSON file above, you would see a page like that:

image:../../images/gs-authz-hello-rs-created-page.png[alt="Resource Server Successfully Created"]

You may take some time now exploring the resource server we just created. But first, let's understand what we just created.

The resource server was created based on the *hello-world-authz-service* client application, as you can see from the following configuration:

```json
{
  "clientId": "hello-world-authz-service",
  ...
}
```

What we did was basically tell {{book.project.name}} that we want that client application acting as a resource server, so we can start creating the resources we want to protect as well the permissions
 and authorization policies we want to use to actually protect the resources.

The purpose of this guide is keep things simple to get you started, so our newly created resource server has a single protected resource, as defined by the following configuration:

```json
{
  ...
  "resources": [
    {
      "name": "Hello World Resource"
    }
  ],
  ...
}
```

The *Hello World Resource* represents a set of one or more resources we want to protect. It can map to a single or to multiple resources in an application.

In order to protect it, we need to create the authorization policies and permissions we want to apply. Policies define the conditions that must be satisfied to grant a permission. Where a
permission is the link between a resource and the policies(or conditions) we want to enforce when someone wants to access a resource.

In this example, we have a single policy *Only Special Users Policy*. This policy tells that only the specified users are allowed to access _something_ (we don't know what, yet. That is up to the permission).

[NOTE]
{{book.project.name}} provides a few link:../policy/overview.html[policy types] that you can start using out-of-the-box. There are policies for RBAC, time constraints or even rules written using JavaScript or JBoss Drools.

The last step when protecting a resource is to define a permission. For that, we have defined a *Hello World Resource Permission* that links the resource we want to protect, _Hello World Resource_, with the
policy we want to apply to that resource, _Only Special Users Policy_.

```json
{
  "name": "Hello World Resource Permission",
  "type": "resource",
  "config": {
    "resources": "[\"Hello World Resource\"]",
    "applyPolicies": "[\"Only Special Users Policy\"]"
  }
}

```